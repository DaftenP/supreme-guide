<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.enjoytrips.model.dao.QnaDao">

    <!-- 글 조회  -->
    <select id="list" parameterType="searchCondition" resultType="qna">
        SELECT
        qna_id, qna_title, qna_content, qna_view, qna_writer, qna_create_date
        FROM
        qna
        <where>
            <if test="key != 'none'">
                ${key} LIKE CONCAT('%', #{word}, '%')
            </if>
            <if test="orderBy != 'none'">
                ORDER BY ${orderBy} ${orderByDir}
            </if>

            <if test="limit">
                LIMIT #{offset}, #{countPerPage}
            </if>
        </where>
        ;
    </select>

    <insert id="regist" parameterType="qna">
        INSERT INTO qna(qna_id, qna_title, qna_content, qna_view, qna_writer)
        VALUES (#{qnaId}, #{qnaTitle}, #{qnaContent}, #{qnaView}, #{qnaWriter})
    </insert>

    <select id="select" parameterType="int" resultType="qna">
        SELECT *
        FROM qna
        WHERE qna_id = #{qnaId}
    </select>

    <update id="modify" parameterType="qna">
        UPDATE qna
        SET qna_title = #{qnaTitle}, qna_content = #{qnaContent}
        WHERE qna_id = #{qnaId}
    </update>

    <update id="updateView" parameterType="int">
        UPDATE qna
        SET qna_view = qna_view + 1
        WHERE qna_id = #{qnaId}
    </update>

    <delete id="delete" parameterType="int">
        DELETE
        FROM qna
        WHERE qna_id = #{qnaId}
    </delete>

<!--    <select id="selectComment" parameterType="int" resultType="qna" resultMap="QnaWithComments">-->
<!--        SELECT-->
<!--            q.qna_id,-->
<!--            q.qna_title,-->
<!--            q.qna_content,-->
<!--            q.qna_view,-->
<!--            q.qna_writer,-->
<!--            q.qna_create_date,-->
<!--            qc.qna_comment_id,-->
<!--            qc.qna_comment_content,-->
<!--            qc.qna_comment_harmful-->
<!--        FROM-->
<!--            qna q-->
<!--                LEFT JOIN qna_comment qc ON q.qna_id = qc.qna_qna_id-->
<!--        WHERE-->
<!--            q.qna_id = #{qnaId}-->
<!--    </select>-->

<!--    <resultMap id="QnaWithComments" type="Qna">-->
<!--        <result property="qnaId" column="qna_id"/>-->
<!--        <result property="qnaTitle" column="qna_title" />-->
<!--        <result property="qnaContent" column="qna_content" />-->
<!--        <result property="qnaView" column="qna_view" />-->
<!--        <result property="qnaWriter" column="qna_writer"/>-->
<!--        <collection property="comments" ofType="qnaComment">-->
<!--            <id property="qnaCommentId" column="qna_comment_id" />-->
<!--            <result property="qnaCommentContent" column="qna_comment_content" />-->
<!--            <result property="qnaCommentHarmful" column="qna_comment_harmful" />-->
<!--            <result property="qnaId" column="qna_qna_id" />-->
<!--            <result property="userId" column="user_user_id" />-->
<!--        </collection>-->
<!--    </resultMap>-->
    <resultMap id="commentResultMap" type="comment">
        <id property="commentId" column="qna_comment_id" />
        <result property="commentContent" column="qna_comment_content" />
        <result property="commentHarmful" column="qna_comment_harmful" />
        <result property="qnaId" column="qna_qna_id"/>
        <result property="userId" column="user_user_id" />
    </resultMap>

    <select id="selectComment" parameterType="int" resultMap="commentResultMap">
        SELECT
            qna_comment_id, qna_comment_content, qna_comment_harmful, qna_qna_id, user_user_id
        FROM
            qna_comment
        WHERE
            qna_qna_id = #{qnaId}
    </select>

</mapper>